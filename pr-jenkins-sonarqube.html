<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jenkins and SonarQube using Docker Compose</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<a href="index.html" class="back-button" title="Go back">
  &#8592;
</a>

<h1>Jenkins CI Pipeline with SonarQube Using Docker Compose</h1>
<p><em>By Alleoko</em></p>

<p>
This guide walks you through setting up <strong>Jenkins</strong> and <strong>SonarQube</strong> using
<strong>Docker Compose</strong>, configuring Jenkins to connect to SonarQube, and verifying
their connectivity using a Jenkins pipeline.
</p>

<hr />

<h2>1. Prerequisites</h2>
<p>Make sure the following tools are installed on your machine:</p>
<ul>
  <li>Docker</li>
  <li>Docker Compose (v2)</li>
</ul>

<p>Verify installation:</p>
<pre><code>docker --version
docker compose version</code></pre>

<hr />

<h2>2. Project Structure</h2>
<p>Create a new directory for the project:</p>

<pre><code>jenkins-sonarqube/
├── docker-compose.yml
└── jenkins/
    └── Dockerfile</code></pre>

<hr />

<h2>3. Create Docker Compose Configuration</h2>
<p>Create a file named <code>docker-compose.yml</code>:</p>

<pre><code>version: "3.8"

services:
  sonarqube:
    image: sonarqube:9.9-community
    container_name: sonarqube
    ports:
      - "9000:9000"
    environment:
      SONAR_ES_BOOTSTRAP_CHECKS_DISABLE: "true"
    volumes:
      - sonarqube_data:/opt/sonarqube/data
      - sonarqube_logs:/opt/sonarqube/logs
      - sonarqube_extensions:/opt/sonarqube/extensions
    networks:
      - devops-net

  jenkins:
    build: ./jenkins
    container_name: jenkins
    ports:
      - "8080:8080"
      - "50000:50000"
    volumes:
      - jenkins_home:/var/jenkins_home
      - /var/run/docker.sock:/var/run/docker.sock
    depends_on:
      - sonarqube
    networks:
      - devops-net

volumes:
  jenkins_home:
  sonarqube_data:
  sonarqube_logs:
  sonarqube_extensions:

networks:
  devops-net:</code></pre>

<hr />

<h2>4. Create Jenkins Dockerfile</h2>
<p>
This Dockerfile installs Docker CLI and basic utilities inside Jenkins so it can
run pipelines properly.
</p>

<p>Create <code>jenkins/Dockerfile</code>:</p>

<pre><code>FROM jenkins/jenkins:lts

USER root

RUN apt-get update && \
    apt-get install -y docker.io curl unzip && \
    apt-get clean

USER jenkins</code></pre>

<hr />

<h2>5. Start Jenkins and SonarQube</h2>
<p>From the project root directory, run:</p>

<pre><code>docker compose up -d</code></pre>

<p>Verify running containers:</p>

<pre><code>docker ps</code></pre>

<hr />

<h2>6. Access Jenkins and SonarQube</h2>

<h3>Jenkins</h3>
<ul>
  <li>URL: <code>http://localhost:8080</code></li>
  <li>Get initial admin password:</li>
</ul>

<pre><code>docker exec jenkins cat /var/jenkins_home/secrets/initialAdminPassword</code></pre>

<h3>SonarQube</h3>
<ul>
  <li>URL: <code>http://localhost:9000</code></li>
  <li>Default credentials:</li>
</ul>

<pre><code>username: admin
password: admin</code></pre>

<p>Change the password when prompted.</p>

<hr />

<h2>7. Create SonarQube Token</h2>
<p>In SonarQube:</p>
<ul>
  <li>Go to <strong>Administration → Security → Users</strong></li>
  <li>Click <strong>Generate Token</strong></li>
  <li>Copy and save the token</li>
</ul>

<hr />

<h2>8. Configure Jenkins for SonarQube</h2>

<h3>Install Required Plugins</h3>
<p>Go to <strong>Manage Jenkins → Plugins</strong> and install:</p>
<ul>
  <li>SonarQube Scanner</li>
  <li>Pipeline</li>
  <li>Git</li>
</ul>

<h3>Add SonarQube Server</h3>
<p>Go to <strong>Manage Jenkins → System</strong>:</p>

<ul>
  <li>Name: <code>sonarqube</code></li>
  <li>Server URL: <code>http://sonarqube:9000</code></li>
  <li>Authentication Token: SonarQube token</li>
</ul>

<p><strong>Note:</strong> The hostname <code>sonarqube</code> works because both containers share the same Docker network.</p>

<hr />

<h2>9. Install SonarQube Scanner Tool</h2>
<p>Go to <strong>Manage Jenkins → Tools</strong>:</p>
<ul>
  <li>Name: <code>sonar-scanner</code></li>
  <li>Enable automatic installation</li>
</ul>

<hr />

<h2>10. Jenkins Pipeline to Check Connectivity</h2>
<p>This pipeline verifies Jenkins can reach SonarQube and performs a code scan.</p>

<pre><code>pipeline {
  agent any

  tools {
    sonarScanner 'sonar-scanner'
  }

  environment {
    SONAR_HOST_URL = 'http://sonarqube:9000'
  }

  stages {

    stage('Check SonarQube Connectivity') {
      steps {
        sh 'curl -s ${SONAR_HOST_URL}/api/system/status'
      }
    }

    stage('SonarQube Analysis') {
      steps {
        withSonarQubeEnv('sonarqube') {
          sh '''
          sonar-scanner \
            -Dsonar.projectKey=demo-project \
            -Dsonar.projectName=DemoProject \
            -Dsonar.sources=.
          '''
        }
      }
    }

    stage('Quality Gate') {
      steps {
        timeout(time: 5, unit: 'MINUTES') {
          waitForQualityGate abortPipeline: true
        }
      }
    }
  }
}</code></pre>

<hr />

<h2>11. Verify Connectivity</h2>
<p>If successful, Jenkins logs will show:</p>

<pre><code>{"status":"UP"}</code></pre>

<p>If it fails, check:</p>
<ul>
  <li>SonarQube URL (do not use localhost)</li>
  <li>Token configuration</li>
  <li>Docker network</li>
</ul>

<hr />

<h2>12. Clean Up</h2>
<p>To stop and remove containers:</p>

<pre><code>docker compose down -v</code></pre>

<hr />

<h2>Wrap-up</h2>
<p>
You have successfully deployed Jenkins and SonarQube using Docker Compose,
connected them securely, and validated their integration through a Jenkins pipeline.
This setup is production-ready and commonly used in real-world DevOps CI pipelines.
</p>

</body>
</html>
